(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/plus-cohort-15",headers:{authorization:"4912f186-aa3c-472a-98c3-6f2a2bb245d9","Content-Type":"application/json"},id:null},t=null,n=document.querySelector("#card").content,r=document.querySelector(".elements"),o=document.querySelector(".popup__photo"),c=document.querySelector(".popup__figcaption");function i(r){var i=n.querySelector(".element").cloneNode(!0);i.querySelector(".element__title").textContent=r.name;var a=i.querySelector(".element__photo");a.src=r.link,a.setAttribute("alt",r.name);var s,l,d,m=i.querySelector(".element__like-counter"),p=i.querySelector(".element__like");if(p.addEventListener("click",(function(t){!function(t,n,r,o){n.likes.find((function(t){return t._id===e.id}))?function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject(e.status)}))}(r).then((function(e){t.target.classList.remove("element__like_active"),o.textContent=e.likes.length,n.likes=e.likes})):function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject(e.status)}))}(r).then((function(e){t.target.classList.add("element__like_active"),o.textContent=e.likes.length,n.likes=e.likes}))}(t,r,r._id,m)})),m.textContent=r.likes.length,r.likes.find((function(t){return t._id===e.id}))&&p.classList.add("element__like_active"),r.owner._id===e.id){var v=i.querySelector(".element__delete");v.addEventListener("click",(function(e){!function(e){t=e._id,P(f)}(r)})),v.classList.add("element__delete_visible"),y.addEventListener("submit",(function(n){!function(n,r,o){var c;n.preventDefault(),t===r._id&&(C(y,"Удаление..."),(c=r._id,fetch("".concat(e.baseUrl,"/cards/").concat(c),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject(e.status)}))).then((function(e){!function(e){e.closest(".element").remove()}(o),j(f)})).catch((function(e){console.log(e)})).finally((function(){C(y,"Да")})))}(n,r,i)}))}return s=a,l=r.name,d=r.link,s.addEventListener("click",(function(){o.src=d,o.alt=l,c.textContent=l,P(u)})),i}function a(e){var t=i(e);r.prepend(t)}var u=document.querySelector(".popup_image"),s=document.querySelector("#profilePopup"),l=document.querySelector("#cardPopup"),d=document.querySelector("#avatarPopup"),f=document.querySelector("#deleteCardPopup"),m=document.forms.profilePopup,p=document.forms.cardPopup,v=document.forms.avatarPopup,y=document.forms.deleteCardPopup,h=document.querySelector(".profile__name"),_=document.querySelector(".profile__about"),S=document.querySelector(".profile__avatar"),b=m.elements.name,k=m.elements.about,L=p.elements.name,q=p.elements.link,E=v.elements.avatarLink;function C(e,t){e.querySelector(".popup__save-button").textContent=t}function g(e){"Escape"===e.key&&j(document.querySelector(".popup_opened"))}function P(e){e.classList.add("popup_opened"),document.addEventListener("keydown",g)}function j(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",g)}function A(e){e.target.classList.contains("popup")&&j(document.querySelector(".popup_opened"))}function B(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));r.classList.remove(n.errorClass),r.textContent="",t.classList.remove(n.errorBorder)}function x(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.removeAttribute("disabled"),t.classList.remove(n.inactiveButtonClass)):(t.setAttribute("disabled",!0),t.classList.add(n.inactiveButtonClass))}function U(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(n){return B(e,n,t)})),x(n,r,t)}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var w,M=document.querySelector(".profile__edit-button"),D=m.elements.closeButton,O=p.elements.closeButton,N=v.elements.closeButton,V=y.elements.closeButton,I=document.querySelector(".profile__add-button"),J=u.querySelector(".popup__close-button"),H=document.querySelectorAll(".popup"),z=document.querySelector(".profile__avatar-overlay"),$={formSelector:".popup__container",inputSelector:".popup__form-input",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_disabled",errorClass:"popup__input-error_active",errorBorder:"popup__form-input_invalid"};function F(e){h.textContent=e.name,_.textContent=e.about,S.src=e.avatar}w=$,Array.from(document.querySelectorAll(w.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);x(n,r,t),n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessageType):t.validity.valueMissing?t.setCustomValidity(t.dataset.errorMessageEmpty):t.validity.typeMismatch?t.setCustomValidity(t.dataset.errorMessageNolink):t.setCustomValidity(""),t.validity.valid?B(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));o.textContent=n,o.classList.add(r.errorClass),t.classList.add(r.errorBorder)}(e,t,t.validationMessage,n)}(e,o,t),x(n,r,t)}))}))}(e,w)})),H.forEach((function(e){e.addEventListener("mousedown",A)})),J.addEventListener("click",(function(){j(u)})),M.addEventListener("click",(function(){b.value=h.textContent,k.value=_.textContent,P(s),U(m,$)})),D.addEventListener("click",(function(){j(s)})),I.addEventListener("click",(function(){p.reset(),P(l),U(p,$)})),O.addEventListener("click",(function(){j(l)})),z.addEventListener("click",(function(){v.reset(),P(d),U(d,$)})),N.addEventListener("click",(function(){j(d)})),V.addEventListener("click",(function(){j(f)})),m.addEventListener("submit",(function(t){var n,r;t.preventDefault(),C(m,"Сохранение..."),(n=b.value,r=k.value,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:n,about:r})}).then((function(e){return e.ok?e.json():Promise.reject(e.status)}))).then((function(e){F(e),j(s)})).catch((function(e){console.log(e)})).finally((function(){C(m,"Сохранить")}))})),p.addEventListener("submit",(function(t){var n,r;t.preventDefault(),C(p,"Сохранение..."),(n=L.value,r=q.value,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:n,link:r})}).then((function(e){return e.ok?e.json():Promise.reject(e.status)}))).then((function(e){a(e),j(l),p.reset();var t=p.querySelector($.submitButtonSelector);x(Array.from(p.querySelectorAll($.inputSelector)),t,$)})).catch((function(e){console.log(e)})).finally((function(){C(p,"Создать")}))})),v.addEventListener("submit",(function(t){t.preventDefault(),C(v,"Сохранение..."),function(t){return fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject(e.status)}))}(E.value).then((function(e){F(e),j(d)})).catch((function(e){console.log(e)})).finally((function(){C(v,"Сохранить")}))})),Promise.all([fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})),fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject(e.status)}))]).then((function(t){var n,r,o=(r=2,function(e){if(Array.isArray(e))return e}(n=t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c=[],i=!0,a=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(c.push(r.value),!t||c.length!==t);i=!0);}catch(e){a=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(a)throw o}}return c}}(n,r)||function(e,t){if(e){if("string"==typeof e)return T(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?T(e,t):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=o[0],i=o[1];F(c),e.id=c._id,i.reverse().forEach((function(e){a(e)}))})).catch((function(e){console.log(e)}))})();