(()=>{"use strict";var e=document.querySelector(".popup_image"),t=document.querySelector("#profilePopup"),n=document.querySelector("#cardPopup"),o=document.querySelector("#avatarPopup"),r=document.querySelector("#deleteCardPopup"),c=document.forms.profilePopup,i=document.forms.cardPopup,a=document.forms.avatarPopup,u=document.forms.deleteCardPopup,s=document.querySelector(".profile__name"),l=document.querySelector(".profile__about"),d=document.querySelector(".profile__avatar"),f=c.elements.name,p=c.elements.about,m=i.elements.name,v=i.elements.link,y=a.elements.avatarLink;function _(e,t){e.querySelector(".popup__save-button").textContent=t}function h(e){"Escape"===e.key&&S(document.querySelector(".popup_opened"))}function k(e){e.classList.add("popup_opened"),document.addEventListener("keydown",h)}function S(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",h)}function b(e){e.target.classList.contains("popup")&&S(document.querySelector(".popup_opened"))}var L={baseUrl:"https://nomoreparties.co/v1/plus-cohort-15",token:"4912f186-aa3c-472a-98c3-6f2a2bb245d9",id:null},q=document.querySelector("#card").content,E=document.querySelector(".elements"),C=document.querySelector(".popup__photo"),g=document.querySelector(".popup__figcaption");function j(t){var n=q.querySelector(".element").cloneNode(!0);n.querySelector(".element__title").textContent=t.name;var o=n.querySelector(".element__photo");o.src=t.link,o.setAttribute("alt",t.name);var c,i,a,s=n.querySelector(".element__like-counter"),l=n.querySelector(".element__like");if(l.addEventListener("click",(function(e){!function(e,t,n,o){t.likes.find((function(e){return e._id===L.id}))?function(e){return fetch("".concat(L.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:{authorization:L.token,"Content-Type":"application/json"}})}(n).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(n){e.target.classList.remove("element__like_active"),o.textContent=n.likes.length,t.likes=n.likes})):function(e){return fetch("".concat(L.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:{authorization:L.token,"Content-Type":"application/json"}})}(n).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(n){e.target.classList.add("element__like_active"),o.textContent=n.likes.length,t.likes=n.likes}))}(e,t,t._id,s)})),s.textContent=t.likes.length,t.likes.find((function(e){return e._id===L.id}))&&l.classList.add("element__like_active"),t.owner._id===L.id){var d=n.querySelector(".element__delete");d.addEventListener("click",(function(e){k(r)})),d.classList.add("element__delete_visible"),u.addEventListener("submit",(function(e){!function(e,t,n){var o;e.preventDefault(),_(u,"Удаление..."),(o=t._id,fetch("".concat(L.baseUrl,"/cards/").concat(o),{method:"DELETE",headers:{authorization:L.token,"Content-Type":"application/json"}})).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){!function(e){e.closest(".element").remove()}(n),S(r)})).catch((function(e){console.log(e)})).finally((function(){_(u,"Да")}))}(e,t,n)}))}return c=o,i=t.name,a=t.link,c.addEventListener("click",(function(){C.src=a,C.alt=i,g.textContent=i,k(e),document.addEventListener("keydown",h)})),n}function P(e){var t=j(e);E.prepend(t)}function A(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));o.classList.remove(n.errorClass),o.textContent="",t.classList.remove(n.errorBorder)}function B(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.removeAttribute("disabled"),t.classList.remove(n.inactiveButtonClass)):(t.setAttribute("disabled",!0),t.classList.add(n.inactiveButtonClass))}function T(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){return A(e,n,t)})),B(n,o,t)}var x,U=document.querySelector(".profile__edit-button"),z=c.elements.closeButton,D=i.elements.closeButton,M=a.elements.closeButton,w=u.elements.closeButton,N=document.querySelector(".profile__add-button"),O=e.querySelector(".popup__close-button"),V=document.querySelectorAll(".popup"),J=document.querySelector(".profile__avatar-overlay"),H={formSelector:".popup__container",inputSelector:".popup__form-input",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_disabled",errorClass:"popup__input-error_active",errorBorder:"popup__form-input_invalid"};function F(e){s.textContent=e.name,l.textContent=e.about,d.src=e.avatar}x=H,Array.from(document.querySelectorAll(x.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);B(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessageType):t.validity.valueMissing?t.setCustomValidity(t.dataset.errorMessageEmpty):t.validity.typeMismatch?t.setCustomValidity(t.dataset.errorMessageNolink):t.setCustomValidity(""),t.validity.valid?A(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));r.textContent=n,r.classList.add(o.errorClass),t.classList.add(o.errorBorder)}(e,t,t.validationMessage,n)}(e,r,t),B(n,o,t)}))}))}(e,x)})),V.forEach((function(e){e.addEventListener("mousedown",b)})),O.addEventListener("click",(function(){S(e)})),U.addEventListener("click",(function(){f.value=s.textContent,p.value=l.textContent,k(t),T(c,H)})),z.addEventListener("click",(function(){S(t)})),N.addEventListener("click",(function(){i.reset(),k(n),T(i,H)})),D.addEventListener("click",(function(){S(n)})),J.addEventListener("click",(function(){a.reset(),k(o),T(o,H)})),M.addEventListener("click",(function(){S(o)})),w.addEventListener("click",(function(){S(r)})),c.addEventListener("submit",(function(e){var n,o;e.preventDefault(),_(c,"Сохранение..."),(n=f.value,o=p.value,fetch("".concat(L.baseUrl,"/users/me"),{method:"PATCH",headers:{authorization:L.token,"Content-Type":"application/json"},body:JSON.stringify({name:n,about:o})})).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){F(e),S(t)})).catch((function(e){console.log(e)})).finally((function(){_(c,"Сохранить")}))})),i.addEventListener("submit",(function(e){var t,o;e.preventDefault(),_(i,"Сохранение..."),(t=m.value,o=v.value,fetch("".concat(L.baseUrl,"/cards"),{method:"POST",headers:{authorization:L.token,"Content-Type":"application/json"},body:JSON.stringify({name:t,link:o})})).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){P(e),S(n),i.reset();var t=i.querySelector(H.submitButtonSelector);B(Array.from(i.querySelectorAll(H.inputSelector)),t,H)})).catch((function(e){console.log(e)})).finally((function(){_(i,"Создать")}))})),a.addEventListener("submit",(function(e){e.preventDefault(),_(a,"Сохранение..."),function(e){return fetch("".concat(L.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:{authorization:L.token,"Content-Type":"application/json"},body:JSON.stringify({avatar:e})})}(y.value).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){F(e),S(o)})).catch((function(e){console.log(e)})).finally((function(){_(a,"Сохранить")}))})),fetch("".concat(L.baseUrl,"/users/me"),{headers:{authorization:L.token}}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){F(e),L.id=e._id,fetch("".concat(L.baseUrl,"/cards"),{headers:{authorization:L.token}}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){e.reverse().forEach((function(e){P(e)}))})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)}))})();